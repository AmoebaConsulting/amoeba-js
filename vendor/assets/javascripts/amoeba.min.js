/*! amoeba - v0.2.0 - 2013-01-25
* Copyright (c) 2013 ; Licensed  */
(function(){window.Amoeba={version:"0.2.0"}}).call(this),function(){var e;e={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},Backbone.originalSync=Backbone.sync,Backbone.sync=function(e,t,n){var r,i;return n==null&&(n={}),t&&(e==="create"||e==="update"||e==="patch")&&((i=n.data)==null&&(n.data={}),r={},t.paramRoot?r[t.paramRoot]=t.toJSON(n):r=t.toJSON(n),n.contentType="application/json",n.data=JSON.stringify(_.extend(n.data,r))),Backbone.originalSync(e,t,n)}}.call(this),function(){Amoeba.Helpers=function(){function e(){var e,t,n,r;r=this.constructor.helpers;for(t=0,n=r.length;t<n;t++)e=r[t],this.extractHelper(e)}return e.helpers=[],e.prototype.extractHelper=function(e){var t,n,r;r=[];for(n in e)t=e[n],r.push(this[n]=t.bind(this));return r},e.register=function(e){return this.helpers.push(e)},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Amoeba.PaginatedCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.urlPageQuery="page",n.prototype.reset=function(){return this.nextPage=void 0,n.__super__.reset.apply(this,arguments)},n.prototype.hasMorePages=function(){return _.result(this,"nextPage")!=null},n.prototype.fetchNextPage=function(e){var t,n,r;e==null&&(e={}),r=_.result(this,"url");if(!r)throw"No url specified";return n=""+this.urlPageQuery+"="+_.result(this,"nextPage"),t=~r.indexOf("?")?"&":"?",_.extend(e,{url:""+r+t+n,update:!0,remove:!1}),this.fetch(e)},n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Amoeba.Router=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.render=function(e,t){var n;t==null&&(t={});if(this.currentView!=null)throw"Render already called with "+this.currentView;return n=Amoeba.app.lookupContext.find(e),Amoeba.app.currentView=this.currentView=new n(t)},n}(Backbone.Router)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};Amoeba.Template=function(){function t(t){var n=this;return this.template=t,this.render=e(this.render,this),function(e){return e==null&&(e={}),n.template(_.extend(e,{render:n.render,helpers:Amoeba.app.helpers}))}}return t.prototype.render=function(e,t){var n,r,i;return t==null&&(t={}),(i=t.locals)==null&&(t.locals={}),t.collection?(r=function(){var r,i,s,o,u=this;s=t.collection,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(function(n){var r;return r={},r[e]=n,_.extend(r,t.locals),u._render(e,r)}(n));return o}.call(this),r.join("")):this._render(e,t.locals)},t.prototype._render=function(e,t){e=JST[""+Amoeba.app.templatePath+"/"+e];if(!e)throw""+Amoeba.app.templatePath+"/"+e+" does not exist";return(new Amoeba.Template(e))(t)},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Amoeba.View=function(e){function n(e){e==null&&(e={}),this.locals=e.locals,this.parent=e.parent,this.template&&(this.template=new Amoeba.Template(this.template)),n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype._render=function(e,t){var n;return t==null&&(t={}),t.parent=this,n=Amoeba.app.lookupContext.find(e),new n(t)},n}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};Amoeba.View.Collection=function(t){function r(t){var n;t==null&&(t={}),this.extractSubView=e(this.extractSubView,this),this.render=e(this.render,this),this.subviews=[],(n=t.subView)==null&&(t.subView={}),r.__super__.constructor.call(this,t),this.collection.on("add",this.add.bind(this)),this.collection.on("remove",this.remove.bind(this))}return n(r,t),r.prototype.render=function(){if(this.rendered)return;return this.extractSubViews(),this.$el.html(this.renderSubViews()),this.rendered=!0,this.trigger("render"),this},r.prototype.refresh=function(){return this.subviews=[],this.rendered=!1,this.collection.fetch({success:this.render,silent:!0}),this},r.prototype.extractSubViews=function(){return this.collection.each(this.extractSubView)},r.prototype.extractSubView=function(e){var t;return t=this._render(this.subView,_.extend(this.options.subView,{model:e})),this.subviews.push(t),t},r.prototype.renderSubViews=function(){var e,t=this;return e=document.createDocumentFragment(),_.each(this.subviews,function(t){return e.appendChild(t.render().el)}),e},r.prototype.add=function(e){var t;t=this.extractSubView(e);if(this.rendered)return this.$el.append(t.render().el),this.trigger("render")},r.prototype.remove=function(e){var t;t=_.select(this.subviews,function(t){return t.model.id===e.id})[0];if(t){this.subviews=_.without(this.subviews,t);if(this.rendered)return t.$el.remove()}},r}(Amoeba.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};Amoeba.View.ScrollableCollection=function(t){function r(){this.onLoad=e(this.onLoad,this),this.onScroll=e(this.onScroll,this),r.__super__.constructor.apply(this,arguments),$(window).on("scroll."+this.cid,this.onScroll)}return n(r,t),r.prototype.loading=!1,r.prototype.padding=100,r.prototype.onScroll=function(){if(!this.rendered||this.loading)return!0;if(this.scrolledToBottom()&&this.collection.hasMorePages())return this.loading=!0,this.collection.fetchNextPage({success:this.onLoad,error:this.onLoad})},r.prototype.scrolledToBottom=function(){var e,t,n,r,i,s;return s=$(window).height(),r=$(window).scrollTop(),i=s+r,t=this.$el.height(),n=this.$el.offset().top,e=t+n,e+this.padding<i},r.prototype.onLoad=function(){return this.loading=!1},r}(Amoeba.View.Collection)}.call(this),function(){Amoeba.LookupContext=function(){function e(e){this.viewPath=e}return e.prototype.getNamespaces=function(e){return e.split(".")},e.prototype.recurse=function(e,t){var n,r,i,s;if(!e)return void 0;if(!t.length)return e;r=this.getNamespaces(t);for(i=0,s=r.length;i<s;i++){n=r[i];if(!e[n]){e=void 0;break}e=e[n]}return e},e.prototype.findFromViewPath=function(e,t){var n,r;return t==null&&(t=window),r=this.getNamespaces(e),n=r.shift(),this.recurse(t[n],r.join("."))},e.prototype.find=function(e,t){var n;if(!e)throw"A template is required";if(typeof e!="string")return e;this.viewPath?n=this.recurse(this.viewPath,e):n=this.findFromViewPath(e,t);if(!n)throw"Cannot find template "+e;return n},e}()}.call(this),function(){var e,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};e=["extended","included"],Amoeba.Module=function(){function n(){}return n.extend=function(n){var r,i,s;for(r in n)i=n[r],t.call(e,r)<0&&(this[r]=i);return(s=n.extended)!=null&&s.apply(this),this},n.include=function(n){var r,i,s;for(r in n)i=n[r],t.call(e,r)<0&&(this.prototype[r]=i);return(s=n.included)!=null&&s.apply(this),this},n}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Amoeba.App=function(e){function n(e){e==null&&(e={}),this.helpers=new Amoeba.Helpers,this.lookupContext=new Amoeba.LookupContext(e.viewPath),e.templatePath&&(this.templatePath=e.templatePath),this.initialize.apply(this,arguments),this}return t(n,e),n.include(Backbone.Events),n.start=function(e){return e==null&&(e={}),Amoeba.app=new this(e),Backbone.history.start(_.pick(e,"pushState","hashChange","silent","root")),Amoeba.app},n.prototype.initialize=function(){},n}(Amoeba.Module)}.call(this),function(){Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),Function.bind||(Function.bind=function(e){var t=this;return function(){return t.apply(e,arguments)}})}(),function(){}.call(this);